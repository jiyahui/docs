

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>[RTL8722CSM] [RTL8722DM] Use MQTT To Upload And Listen To Data &mdash; amebaDocs 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="[RTL8722CSM] [RTL8722DM] Use Amazon AWS IoT Shadow Service" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Amazon%20AWS%20IoT%20Shadow%20Service.html" />
    <link rel="prev" title="[RTL8722CSM] [RTL8722DM] Retrieve Universal Time (UTC) By Ameba" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Retrieve%20Universal%20Time%20%28UTC%29%20By%20Ameba.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> amebaDocs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Welcome to amebaDocs’s documentation!</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download/index.html">Download</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Peripherals &amp; Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Basic%20Examples.html">Basic Examples</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="Network%20Examples.html">Network Examples</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Scan%20available%20WiFi%20hotspots%20in%20the%20surroundings.html">[RTL8722CSM] [RTL8722DM] Scan available WiFi hotspots in the surroundings</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Connect%20to%20WiFi.html">[RTL8722CSM] [RTL8722DM] Connect to WiFi</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Ameba%20as%20Server%20to%20communicate%20with%20Client.html">[RTL8722CSM] [RTL8722DM] Use Ameba as Server to communicate with Client</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Ameba%20to%20retrieve%20HTTP%20websites%20from%20the%20internet.html">[RTL8722CSM] [RTL8722DM] Use Ameba to retrieve HTTP websites from the internet</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Ameba%20to%20retrieve%20information%20from%20the%20Internet.html">[RTL8722CSM] [RTL8722DM] Use Ameba to retrieve information from the Internet</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Ameba%20as%20Server%20to%20control%20LED.html">[RTL8722CSM] [RTL8722DM] Use Ameba as Server to control LED</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Ameba%20as%20server%20to%20send%20Ameba%20status.html">[RTL8722CSM] [RTL8722DM] Use Ameba as server to send Ameba status</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Ameba%20as%20UDP%20server.html">[RTL8722CSM] [RTL8722DM] Use Ameba as UDP server</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Retrieve%20Universal%20Time%20%28UTC%29%20By%20Ameba.html">[RTL8722CSM] [RTL8722DM] Retrieve Universal Time (UTC) By Ameba</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">[RTL8722CSM] [RTL8722DM] Use MQTT To Upload And Listen To Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Amazon%20AWS%20IoT%20Shadow%20Service.html">[RTL8722CSM] [RTL8722DM] Use Amazon AWS IoT Shadow Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20MQTT%20over%20TLS.html">[RTL8722CSM] [RTL8722DM] Use MQTT over TLS</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Ameba%20AP%20Mode.html">[RTL8722CSM] [RTL8722DM] Ameba AP Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20MDNS%20To%20Let%20Arduino%20IDE%20Find%20Ameba.html">[RTL8722CSM] [RTL8722DM] Use MDNS To Let Arduino IDE Find Ameba</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Firebase%20To%20Push%20Messaging%20Services.html">[RTL8722CSM] [RTL8722DM] Use Firebase To Push Messaging Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%5BRTL8722DM%5D%20Access%20IFTTT%20Via%20Ameba.html">[RTL8722CSM][RTL8722DM] Access IFTTT Via Ameba</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Ameba%20To%20Securely%20Retrieve%20Information%20From%20The%20Internet.html">[RTL8722CSM] [RTL8722DM] Use Ameba To Securely Retrieve Information From The Internet</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20BLE%20%E2%80%93%20BLE%20Battery%20Service.html">[RTL8722CSM] [RTL8722DM] BLE – BLE Battery Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20BLE%20%E2%80%93%20BLE%20Beacon.html">[RTL8722CSM] [RTL8722DM] BLE – BLE Beacon</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20BLE%20%E2%80%93%20BLE%20Scan.html">[RTL8722CSM] [RTL8722DM] BLE – BLE Scan</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20BLE%20%E2%80%93%20Battery%20Client.html">[RTL8722CSM] [RTL8722DM] BLE – Battery Client</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20BLE%20%E2%80%93%20WiFi%20Configuration%20Service.html">[RTL8722CSM] [RTL8722DM] BLE – WiFi Configuration Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20BLE%20%E2%80%93%20BLE%20UART%20Client.html">[RTL8722CSM] [RTL8722DM] BLE – BLE UART Client</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20BLE%20%E2%80%93%20BLE%20UART%20Service.html">[RTL8722CSM] [RTL8722DM] BLE – BLE UART Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20BLE%20%E2%80%93%20DHT%20over%20BLE%20UART.html">[RTL8722CSM] [RTL8722DM] BLE – DHT over BLE UART</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20BLE%20%E2%80%93%20PWM%20over%20BLE%20UART.html">[RTL8722CSM] [RTL8722DM] BLE – PWM over BLE UART</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Approximate%20UDP%20Receive%20Delay.html">[RTL8722CSM] [RTL8722DM] Approximate UDP Receive Delay</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Approximate%20UDP%20Receive%20Timeout.html">[RTL8722CSM] [RTL8722DM] Approximate UDP Receive Timeout</a></li>
<li class="toctree-l4"><a class="reference internal" href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Google%20Cloud%20IoT.html">[RTL8722CSM] [RTL8722DM] Google Cloud IoT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Peripheral%20Examples.html">Peripheral Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="Components%20used.html">Components used</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../board_hdk/index.html">Board HDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_documents/index.html">API Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources/index.html">Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support/index.html">Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#search">Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ambd_micropython/source/index.html">Welcome to amebaDocs’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ambd_micropython/source/index.html#search">Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ambd_sdk/source/index.html">Welcome to ambd_sdk’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ambd_sdk/source/index.html#indices-and-tables">Indices and tables</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">amebaDocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Welcome to amebaDocs’s documentation!</a> &raquo;</li>
        
          <li><a href="index.html">Peripherals &amp; Examples</a> &raquo;</li>
        
          <li><a href="Network%20Examples.html">Network Examples</a> &raquo;</li>
        
      <li>[RTL8722CSM] [RTL8722DM] Use MQTT To Upload And Listen To Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/ambd_arduino/source/peripherals_and_examples/[RTL8722CSM] [RTL8722DM] Use MQTT To Upload And Listen To Data.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rtl8722csm-rtl8722dm-use-mqtt-to-upload-and-listen-to-data">
<h1>[RTL8722CSM] [RTL8722DM] Use MQTT To Upload And Listen To Data<a class="headerlink" href="#rtl8722csm-rtl8722dm-use-mqtt-to-upload-and-listen-to-data" title="Permalink to this headline">¶</a></h1>
<p>Intro to MQTT</p>
<p>MQTT (Message Queuing Telemetry Transport) is a protocol proposed by IBM
and Eurotech. The introduction in <a class="reference external" href="http://mqtt.org/">MQTT Official
Website</a>: MQTT is a machine-to-machine
(M2M)/”Internet of Things” connectivity protocol. It was designed as an
extremely lightweight publish/subscribe messaging transport. We can say
MQTT is a protocol designed for IoT. MQTT is based on TCP/IP and
transmits/receives data via publish/subscribe. Please refer to the
figure below:</p>
<a class="reference internal image-reference" href="../../../_images/image158.png"><img alt="9-1" src="../../../_images/image158.png" style="width: 6.5in; height: 4.26319in;" /></a>
<p>In the operation of MQTT, there are several roles:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Publisher: Usually publishers are the devices equipped with sensors</dt><dd><p>(ex. Ameba). Publishers uploads the data of the sensors to
MQTT-Broker, which serves as a database with MQTT service.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Subscriber: Subscribers are referred to the devices which receive and</dt><dd><p>observe messages, such as a laptop or a mobile phone.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Topic: Topic is used to categorized the messages, for example the</dt><dd><p>topic of a message can be “PM2.5” or “Temperature”. Subscribers
can choose messages of which topics they want to receive.</p>
</dd>
</dl>
</li>
</ul>
<p>Preparation</p>
<ul class="simple">
<li><p>Ameba x 1</p></li>
</ul>
<p>Example</p>
<p>In this example, we connect Ameba to MQTT-Broker. Then send messages as
publisher and receive messages from MQTT-Broker as subscriber. Open the
MQTT example “File” -&gt; “Examples” -&gt; “AmebaMQTTClient” -&gt;
“MQTT_Basic”<a class="reference internal" href="../../../_images/image254.png"><img alt="9-2" src="../../../_images/image254.png" style="width: 5.63194in; height: 7.61111in;" /></a>Please modify some WiFi-related parameters. And
some information related to MQTT:<a class="reference internal" href="../../../_images/image337.png"><img alt="9-3" src="../../../_images/image337.png" style="width: 5.20833in; height: 6.25in;" /></a>  The “mqttServer” refers to the
MQTT-Broker, we use the free MQTT sandbox “test.mosquitto.org” for
testing. “clientId” is an identifier for MQTT-Broker to identify the
connected device. “publishTopic” is the topic of the published message,
we use “outTopic” in the example. The devices subscribe to “outTopic”
will receive the message. “publishPayload” is the content to be
published. “subscribeTopic” is to tell MQTT-broker which topic we want
to subscribe to. Next, compile the code and upload it to Ameba. Press
the reset button, then open the serial monitor<a class="reference internal" href="../../../_images/image433.png"><img alt="9-4" src="../../../_images/image433.png" style="width: 6.5in; height: 4.10833in;" /></a>  After Ameba is
connected to MQTT server, it sends the message “hello world” to
“outTopic”. To see the message, we need another MQTT client. Here we use
a chrome plugin “MQTTLens” to be the MQTT client. You can find it in
google webstore.<a class="reference internal" href="../../../_images/image518.png"><img alt="9-5" src="../../../_images/image518.png" style="width: 6.5in; height: 4.78333in;" /></a>Install and open the MQTTLens, click “+” next
to “Connection” on the left, and fill in the required information</p>
<ul class="simple">
<li><dl class="simple">
<dt>Connection Name: Used to identify the connection, you can choose a</dt><dd><p>name you like.</p>
</dd>
</dl>
</li>
<li><p>Hostname: The MQTT-Broker server, here we use “iot.eclipse.org”</p></li>
<li><p>Client ID: We use the default randomly generated ID.</p></li>
</ul>
<p>Then click “CREATE CONNECTION”.<a class="reference internal" href="../../../_images/image68.png"><img alt="9-6" src="../../../_images/image68.png" style="width: 6.5in; height: 4.47917in;" /></a>Since we have not registered the
topic we want to listen to, we would not receive any messages now. Fill
in “outTopic” in the “Topic” field and click “Subscribe”. Wait for Ameba
to send next message (or you can press the reset button). Then you can
see the “hello world” message show up.<a class="reference internal" href="../../../_images/image76.png"><img alt="9-7" src="../../../_images/image76.png" style="width: 6.5in; height: 4.51042in;" /></a></p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Use%20Amazon%20AWS%20IoT%20Shadow%20Service.html" class="btn btn-neutral float-right" title="[RTL8722CSM] [RTL8722DM] Use Amazon AWS IoT Shadow Service" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="%5BRTL8722CSM%5D%20%5BRTL8722DM%5D%20Retrieve%20Universal%20Time%20%28UTC%29%20By%20Ameba.html" class="btn btn-neutral float-left" title="[RTL8722CSM] [RTL8722DM] Retrieve Universal Time (UTC) By Ameba" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Simon XI.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>